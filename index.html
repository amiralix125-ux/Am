<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ | Ú†Øª Ùˆ Ø®Ø±ÛŒØ¯</title>
    <style>
        body { font-family: Tahoma, sans-serif; background: #f0f0f0; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Ù‡Ø¯Ø± Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ Ùˆ Ù†Ø§Ø±Ù†Ø¬ÛŒ */
        header { background: linear-gradient(135deg, #bdc3c7, #2c3e50); color: white; padding: 15px; text-align: center; border-bottom: 4px solid #ff9800; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        h1 { margin: 0; font-size: 1.2rem; }
        
        /* Ù…Ø­ÛŒØ· Ú†Øª */
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background: #e5e5e5; }
        
        .message { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 14px; line-height: 1.5; position: relative; animation: fadeIn 0.3s ease; }
        .user-msg { align-self: flex-end; background: #ff9800; color: white; border-bottom-left-radius: 2px; }
        .bot-msg { align-self: flex-start; background: white; color: #333; border-bottom-right-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        
        /* Ø¨Ø®Ø´ ÙˆØ±ÙˆØ¯ÛŒ Ù¾ÛŒØ§Ù… */
        #input-area { padding: 10px; background: white; border-top: 1px solid #ddd; display: flex; gap: 10px; align-items: center; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-family: inherit; }
        input:focus { border-color: #ff9800; }
        button { background: #ff9800; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: #e68900; }
        button:disabled { background: #ccc; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ùˆ Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>
</header>

<div id="chat-container">
    <div class="message bot-msg">Ø³Ù„Ø§Ù…! ğŸ‘‹ Ù…Ù† Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù‡Ø³ØªÙ…. Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ù¾Ø±Ø³ÛŒØ¯ ÛŒØ§ Ø§Ú¯Ø± Ù…Ø¯ÛŒØ± Ù‡Ø³ØªÛŒØ¯ØŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ ÙˆØ§Ø±Ø¯ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø´ÛŒØ¯.</div>
</div>

<div id="input-area">
    <input type="text" id="user-input" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
    <button onclick="sendMessage()" id="send-btn">Ø§Ø±Ø³Ø§Ù„</button>
</div>

<script>
    // Ø¢Ø¯Ø±Ø³ ÙˆØ¨â€ŒÙ‡ÙˆÚ© Ù†Ù‡Ø§ÛŒÛŒ Ø´Ù…Ø§
    const WEBHOOK_URL = 'https://34109-qzpoy.s3.irann8n.com/webhook/win1';

    async function sendMessage() {
        const input = document.getElementById('user-input');
        const btn = document.getElementById('send-btn');
        const chatBox = document.getElementById('chat-container');
        const text = input.value.trim();

        if (!text) return;

        // 1. Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø±
        addMessage(text, 'user-msg');
        input.value = '';
        btn.disabled = true;
        btn.innerText = '...';

        try {
            // 2. Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ n8n
            const response = await fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text }) // Ø§Ø±Ø³Ø§Ù„ Ù…ØªÙ† Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† message
            });

            const data = await response.json();

            // 3. Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø® Ø±Ø¨Ø§Øª
            // Ø§Ú¯Ø± Ø±Ø¨Ø§Øª Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø§Ø¯ØŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡. Ø§Ú¯Ø± Ù†Ù‡ØŒ Ù¾ÛŒØ§Ù… Ù¾ÛŒØ´â€ŒÙØ±Ø¶.
            const botReply = data.output || data.text || JSON.stringify(data);
            addMessage(botReply, 'bot-msg');

        } catch (error) {
            console.error(error);
            addMessage("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±. Ù„Ø·ÙØ§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.", 'bot-msg');
        }

        btn.disabled = false;
        btn.innerText = 'Ø§Ø±Ø³Ø§Ù„';
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function addMessage(text, className) {
        const chatBox = document.getElementById('chat-container');
        const div = document.createElement('div');
        div.className = `message ${className}`;
        div.innerText = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Enter
    document.getElementById('user-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') sendMessage();
    });
</script>

</body>
</html>
